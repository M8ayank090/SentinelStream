apiVersion: v1
kind: Namespace
metadata:
  name: sentinelstream
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: sentinelstream-config
  namespace: sentinelstream
data:
  SPRING_KAFKA_BOOTSTRAP_SERVERS: "kafka:9092"
  SPRING_DATASOURCE_URL: "jdbc:postgresql://postgres:5432/sentinelstream"
  SPRING_DATASOURCE_USERNAME: "sentinelstream"
  ELASTICSEARCH_HOST: "elasticsearch"
  ELASTICSEARCH_PORT: "9200"
  AUTH_SERVICE_URL: "http://auth-service:8081"
  INGESTION_SERVICE_URL: "http://ingestion-service:8082"
  ALERT_SERVICE_URL: "http://alert-service:8086"
  AUDIT_SERVICE_URL: "http://audit-service:8087"
---
apiVersion: v1
kind: Secret
metadata:
  name: sentinelstream-secrets
  namespace: sentinelstream
type: Opaque
stringData:
  SPRING_DATASOURCE_PASSWORD: "sentinelstream"
  JWT_SECRET: "SentinelStreamSecretKeyFor256BitHMACHS256EncryptionRequired"
  JWT_EXPIRATION_MS: "86400000"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-gateway
  namespace: sentinelstream
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api-gateway
  template:
    metadata:
      labels:
        app: api-gateway
    spec:
      containers:
        - name: api-gateway
          image: sentinelstream/api-gateway:latest
          ports:
            - containerPort: 8080
          env:
            - name: SERVER_PORT
              value: "8080"
          envFrom:
            - configMapRef:
                name: sentinelstream-config
            - secretRef:
                name: sentinelstream-secrets
---
apiVersion: v1
kind: Service
metadata:
  name: api-gateway
  namespace: sentinelstream
spec:
  type: LoadBalancer
  selector:
    app: api-gateway
  ports:
    - port: 8080
      targetPort: 8080
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: auth-service
  namespace: sentinelstream
spec:
  replicas: 1
  selector:
    matchLabels:
      app: auth-service
  template:
    metadata:
      labels:
        app: auth-service
    spec:
      containers:
        - name: auth-service
          image: sentinelstream/auth-service:latest
          ports:
            - containerPort: 8081
          env:
            - name: SERVER_PORT
              value: "8081"
          envFrom:
            - configMapRef:
                name: sentinelstream-config
            - secretRef:
                name: sentinelstream-secrets
---
apiVersion: v1
kind: Service
metadata:
  name: auth-service
  namespace: sentinelstream
spec:
  selector:
    app: auth-service
  ports:
    - port: 8081
      targetPort: 8081
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ingestion-service
  namespace: sentinelstream
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ingestion-service
  template:
    metadata:
      labels:
        app: ingestion-service
    spec:
      containers:
        - name: ingestion-service
          image: sentinelstream/ingestion-service:latest
          ports:
            - containerPort: 8082
          env:
            - name: SERVER_PORT
              value: "8082"
          envFrom:
            - configMapRef:
                name: sentinelstream-config
---
apiVersion: v1
kind: Service
metadata:
  name: ingestion-service
  namespace: sentinelstream
spec:
  selector:
    app: ingestion-service
  ports:
    - port: 8082
      targetPort: 8082
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: enrichment-service
  namespace: sentinelstream
spec:
  replicas: 1
  selector:
    matchLabels:
      app: enrichment-service
  template:
    metadata:
      labels:
        app: enrichment-service
    spec:
      containers:
        - name: enrichment-service
          image: sentinelstream/enrichment-service:latest
          ports:
            - containerPort: 8083
          env:
            - name: SERVER_PORT
              value: "8083"
          envFrom:
            - configMapRef:
                name: sentinelstream-config
---
apiVersion: v1
kind: Service
metadata:
  name: enrichment-service
  namespace: sentinelstream
spec:
  selector:
    app: enrichment-service
  ports:
    - port: 8083
      targetPort: 8083
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: detection-service
  namespace: sentinelstream
spec:
  replicas: 1
  selector:
    matchLabels:
      app: detection-service
  template:
    metadata:
      labels:
        app: detection-service
    spec:
      containers:
        - name: detection-service
          image: sentinelstream/detection-service:latest
          ports:
            - containerPort: 8085
          env:
            - name: SERVER_PORT
              value: "8085"
          envFrom:
            - configMapRef:
                name: sentinelstream-config
---
apiVersion: v1
kind: Service
metadata:
  name: detection-service
  namespace: sentinelstream
spec:
  selector:
    app: detection-service
  ports:
    - port: 8085
      targetPort: 8085
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: indexer-service
  namespace: sentinelstream
spec:
  replicas: 1
  selector:
    matchLabels:
      app: indexer-service
  template:
    metadata:
      labels:
        app: indexer-service
    spec:
      containers:
        - name: indexer-service
          image: sentinelstream/indexer-service:latest
          ports:
            - containerPort: 8084
          env:
            - name: SERVER_PORT
              value: "8084"
          envFrom:
            - configMapRef:
                name: sentinelstream-config
---
apiVersion: v1
kind: Service
metadata:
  name: indexer-service
  namespace: sentinelstream
spec:
  selector:
    app: indexer-service
  ports:
    - port: 8084
      targetPort: 8084
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: alert-service
  namespace: sentinelstream
spec:
  replicas: 1
  selector:
    matchLabels:
      app: alert-service
  template:
    metadata:
      labels:
        app: alert-service
    spec:
      containers:
        - name: alert-service
          image: sentinelstream/alert-service:latest
          ports:
            - containerPort: 8086
          env:
            - name: SERVER_PORT
              value: "8086"
          envFrom:
            - configMapRef:
                name: sentinelstream-config
            - secretRef:
                name: sentinelstream-secrets
---
apiVersion: v1
kind: Service
metadata:
  name: alert-service
  namespace: sentinelstream
spec:
  selector:
    app: alert-service
  ports:
    - port: 8086
      targetPort: 8086
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: audit-service
  namespace: sentinelstream
spec:
  replicas: 1
  selector:
    matchLabels:
      app: audit-service
  template:
    metadata:
      labels:
        app: audit-service
    spec:
      containers:
        - name: audit-service
          image: sentinelstream/audit-service:latest
          ports:
            - containerPort: 8087
          env:
            - name: SERVER_PORT
              value: "8087"
          envFrom:
            - configMapRef:
                name: sentinelstream-config
            - secretRef:
                name: sentinelstream-secrets
---
apiVersion: v1
kind: Service
metadata:
  name: audit-service
  namespace: sentinelstream
spec:
  selector:
    app: audit-service
  ports:
    - port: 8087
      targetPort: 8087
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ml-anomaly-service
  namespace: sentinelstream
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ml-anomaly-service
  template:
    metadata:
      labels:
        app: ml-anomaly-service
    spec:
      containers:
        - name: ml-anomaly-service
          image: sentinelstream/ml-anomaly-service:latest
          ports:
            - containerPort: 8088
---
apiVersion: v1
kind: Service
metadata:
  name: ml-anomaly-service
  namespace: sentinelstream
spec:
  selector:
    app: ml-anomaly-service
  ports:
    - port: 8088
      targetPort: 8088
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend
  namespace: sentinelstream
spec:
  replicas: 1
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: frontend
    spec:
      containers:
        - name: frontend
          image: sentinelstream/frontend:latest
          ports:
            - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: frontend
  namespace: sentinelstream
spec:
  type: LoadBalancer
  selector:
    app: frontend
  ports:
    - port: 80
      targetPort: 80
